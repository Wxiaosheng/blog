### TCP协议：如何保证页面文件能被完整送达浏览器？

衡量 web页面性能的重要指标 **FP（First Paint）**，是指 **从页面加载到首次开始绘制的时长**，那么什么影响FP指标呢？  

其中一个最重要的因素就是 **网络加载速度**  

站在数据包的视角来看，如何保证页面文件能被完整地送达浏览器呢？

#### 1、IP：把数据包送达目的主机
数据包要在互联网上进行传输，那就要符合 网际协议(Internet Protocol，简称 IP) 标准  
互联网上不同的在线设备都有唯一的地址，计算机的地址就称为 IP 地址，访问任何网站实际上只是你的计算机向另外一台计算机请求信息  

#### 2、UDP：把数据包送达应用程序
IP 是非常底层的协议，只负责把数据包传送到对方电脑，但是对方电脑并不知道把数据包交给哪个程序   
因此，需要基于 IP 之上开发能和应用打交道的协议，最常见的是“用户数据包协议（User Datagram Protocol）”，简称 UDP  
IP 通过 IP地址信息 把数据包发送给指定的电脑，而 UDP 通过端口号把数据包分发给正确的程序  

**注意**，UDP 不能保证数据可靠性，但是传输速度却非常快，所以 UDP 会应用在一些关注速度、但不那么严格要求数据完整性的领域，如在线视频、互动游戏等  

##### 3、TCP：把数据完整的送达应用程序
对于浏览器请求，或者邮件这类要求数据传输可靠性（reliability）的应用，如果使用 UDP 来传输会存在两个问题：
1. 数据包在传输过程中容易丢失
2. 数据包会经过不同的路由，并在不同的时间到达接收端，UDP 协议并不知道如何组装这些数据包，从而把这些数据包还原成完整的文件

为了解决这两个问题，引入了 TCP。

**TCP（Transmission Control Protocol，控制传输协议），是一种面向连接的、可靠的、基于字节流的传输层通信协议**

相比于 UDP，TCP 有以下特点：
1. 对于数据包丢失的情况，TCP 提供 **超时重传机制**
2. TCP 引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件


###### 一个完整的 TCP 连接的生命周期
1. 建立连接
  * 面向连接是指在数据通信开始之前先做好两端之间的准备工作
  * 通过三次握手建立连接，在建立一个 TCP 连接时，客户端和服务器总共要发送三个数据包以确认连接的建立
2. 传输数据
  * 接收端需要对每个数据包进行确认操作，也就是接收端在接收到数据包之后，需要发送确认数据包给发送端
  * 当发送端发送了一个数据包之后，在规定时间内没有接收到接收端反馈的确认消息，则判断为数据包丢失，并触发发送端的重发机制
3. 断开连接
  * 四次挥手，保证双方都能断开连接

##### HTTP 协议 和 TCP 协议的关系
**下层为上层提供服务**，HTTP协议属于应用层，TCP协议属于传输层，HTTP协议位于TCP协议的上层

#### 总结
1. 互联网中的数据是通过数据包来传输的，数据包在传输过程中容易丢失或出错
2. IP 负责把数据包送达目的主机
3. UDP 负责把数据包送达具体的应用，速度非常快，但是不能保证数据可靠性
4. TCP 负责把数据包送达具体的应用，保证了数据完整地传输
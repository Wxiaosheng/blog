### HTTP：请求流程，为什么很多站点二次打开的速度很快？

#### HTTP （HyperText Transfer Protocol） 协议
HTTP 是一种允许浏览器向服务器获取资源的协议，是 web 的基础，通常由浏览器发起请求，来获取不同类型的文件，例如 HTML文件、CSS文件、JS文件、图片、音视频等文件

#### 浏览器发起HTTP请求流程
##### 1、构建请求
浏览器构建请求行信息，构建好后，浏览器准备发起网络请求

    GET /index.html HTTP1.1

##### 2、查找缓存
浏览器缓存是一种在本地保存资源副本，以供下次请求时直接使用的技术  

好处：
1. 缓解服务器压力，提升性能
2. 提升网站打开速度，缓存是实现快速资源加载的重要组成部分

##### 3、准备IP地址和端口
HTTP 和 TCP 的关系：
1. 浏览器使用 HTTP 协议作为应用层协议，用来封装请求的文本信息
2. 使用 TCP/IP 作传输层协议将它发到网络上
3. 所以在 HTTP 工作开始之前，浏览器需要通过 TCP 与服务器建立连接

**HTTP 的内容是通过 TCP 的传输数据阶段来实现的**
![HTTP和TCP的关系](/images/TCP_HTTP.png)


建立 TCP 连接的第一步就是需要准备 IP 地址和端口号，如何获取呢？  
* 负责把域名和 IP 地址做一一映射关系，即“域名系统”，简称 DNS（Domain Name System）
* 第一步浏览器会请求 DNS 返回域名对应的 IP
* URL 没有特别指明端口号，那么 HTTP 协议默认是 80 端口

##### 4、等待 TCP 队列
Chrome 有个机制，同一个域名同时最多只能建立 6 个 TCP 连接，如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队等待状态，直至进行中的请求完成

##### 5、建立 TCP 连接
在 HTTP 工作开始之前，浏览器通过 TCP 与服务器建立连接  
**三次握手建立连接**

##### 6、发送 HTTP 请求
一旦建立了 TCP 连接，浏览器就可以和服务器进行通信了。而 HTTP 中的数据正是在这个通信过程中传输的
![http_request](/images/http_request.png)

* 首先浏览器会向服务器发送请求行，它包括了请求方法、请求 URI（Uniform Resource Identifier）和 HTTP 版本协议
* 服务器端处理 HTTP 请求流程
  1. 返回请求
  2. 断开连接
    * 保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度
  3. 重定向 - 301 / 302 

![http_response](/images/http_response.png)


#### 总结

![web_request](/images/web_request.png)
